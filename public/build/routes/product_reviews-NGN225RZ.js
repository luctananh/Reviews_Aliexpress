import"/build/_shared/chunk-APGL74VL.js";import{a as O,b as T,c as L,d as E,e as F}from"/build/_shared/chunk-ROFSN5VO.js";import{a as I,b as ee}from"/build/_shared/chunk-AYIHL7SN.js";import{a as G}from"/build/_shared/chunk-KHH5AA7I.js";import{b as J,c as Q,d as z,e as k}from"/build/_shared/chunk-BMZJEWOM.js";import{a as Y}from"/build/_shared/chunk-JFGTJ2G4.js";import{g as h,h as S,i as _,j as U,k as Ie,l as ke}from"/build/_shared/chunk-P7B4R23W.js";import"/build/_shared/chunk-JI256XCL.js";import"/build/_shared/chunk-P6ZGV53T.js";import{q as r}from"/build/_shared/chunk-5LJH62OD.js";import{a as f,b as X}from"/build/_shared/chunk-VRBKQU2G.js";import"/build/_shared/chunk-SSRZKJVQ.js";import"/build/_shared/chunk-UIOUHADL.js";import{g as w,h as x,m as Z,o as K}from"/build/_shared/chunk-3D2VXHQT.js";import{a as q,b as W}from"/build/_shared/chunk-F33EF4G7.js";import{d as c}from"/build/_shared/chunk-2QEWK57A.js";var te=c(q(),1);var Ce=c(Ie(),1),De=c(ke(),1);var Re=c(Y(),1);var Be=c(Y(),1);var n=c(q(),1);var e=c(W(),1);var Pe=u=>!u||u.length===0?[]:u.map(s=>({...s})),Me=({rating:u})=>{let s=parseInt(u,10);if(isNaN(s))return(0,e.jsx)("div",{children:"Invalid rating"});let g=[];for(let m=1;m<=5;m++)g.push((0,e.jsx)("span",{className:m<=s?"star filled":"star",children:"\u2605"},m));return(0,e.jsx)("div",{className:"star-rating",children:g})};function oe(){let{reviews:u,user:s,totalReviewCount:g,nameProduct:m}=Z(),[ae,C]=(0,n.useState)(!1),[re,D]=(0,n.useState)(null),[i,ne]=(0,n.useState)(null),[xe,se]=(0,n.useState)(""),[Se,ie]=(0,n.useState)(!1),[le,b]=(0,n.useState)(!1),[R,A]=(0,n.useState)(""),[j,$]=(0,n.useState)(""),[de,_e]=te.default.useState("inside"),ce=K(),ue=t=>{D(t),C(!0)},Ue=t=>{D(t),ie(!0)},pe=t=>{ne(t),se(t.reviewContent),b(!0)},[N,y]=(0,n.useState)(!1),me=async t=>{t.preventDefault(),y(!0);let o=new FormData(t.target),p=o.get("reviewId");try{let d=await fetch("/delete_review",{method:"POST",body:o});console.log(d.status),d.ok?f.success("Delete successful"):f.error(`Failed to delete. Status code: ${d.status}`)}catch(d){console.error("Error deleting review:",d),f.error("Error occurred while deleting review")}finally{y(!1),setTimeout(()=>{window.location.reload()},500),H()}},H=()=>{C(!1),D(null)},he=()=>{ce.submit(null,{method:"post",action:"/auth/logout"})},[a,v]=(0,n.useState)(()=>{if(typeof window<"u"){let t=new URLSearchParams(window.location.search),o=parseInt(t.get("currentPage"),10);return o&&!isNaN(o)?o:1}return 1}),B=10;(0,n.useEffect)(()=>{if(typeof window<"u"){let t=new URLSearchParams(window.location.search);t.set("currentPage",a),window.history.replaceState({},"",`${window.location.pathname}?${t}`)}},[a]);let P=Pe(u),fe=P.length,l=Math.ceil(fe/B),M=(a-1)*B,V=M+B,Oe=P.slice(M,V),ge=()=>{v(t=>Math.min(t+1,l))},ve=()=>{v(t=>Math.max(t-1,1))},we=()=>{let t=[];if(t.push(1),l>5)if(a<=4){for(let o=2;o<=5;o++)t.push(o);t.push("forward"),t.push(l)}else if(a>=5&&a<=l-4)t.push("backward"),t.push(a-1),t.push(a),t.push(a+1),t.push("forward"),t.push(l);else{t.push("backward");for(let o=l-4;o<=l;o++)t.push(o)}else for(let o=2;o<=l;o++)t.push(o);return t},be=async t=>{t.preventDefault(),y(!0);let o=new FormData(t.target);for(let[d,ye]of o.entries())console.log(`${d}: ${ye}`);let p=await fetch("/update_review",{method:"POST",body:o});if(p.ok)f.success("Review updated successfully",{autoClose:5e3}),b(!1);else{let d=await p.json();f.error(`Error: ${d.error}`)}setTimeout(()=>{window.location.reload()},500),y(!1)};function Ne(t,o){o?($("Upload failed: "+o.message),A("")):(A(t),$(""))}return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(X,{position:"top-center",richColors:!0}),(0,e.jsxs)(J,{className:"custom-navbar2",children:[(0,e.jsx)(Q,{children:(0,e.jsx)("img",{src:"/logo.png",alt:"logo",height:"70px",width:"70px"})}),(0,e.jsxs)(z,{className:"hidden sm:flex gap-4",justify:"center",children:[(0,e.jsx)(k,{children:(0,e.jsx)(w,{color:"foreground",href:"#"})}),(0,e.jsx)(k,{children:(0,e.jsx)(w,{color:"foreground",href:"#","aria-current":"page"})}),(0,e.jsx)(k,{children:(0,e.jsx)(w,{color:"foreground",href:"#"})})]}),(0,e.jsx)(z,{as:"div",justify:"end",children:(0,e.jsxs)(U,{placement:"bottom-end",children:[(0,e.jsx)(_,{children:(0,e.jsx)(G,{isBordered:!0,as:"button",className:"transition-transform",color:"success",name:s._json.name,size:"sm",src:s._json.picture})}),(0,e.jsxs)(S,{"aria-label":"Profile Actions",variant:"flat",children:[(0,e.jsxs)(h,{className:"h-14 gap-2",children:[(0,e.jsx)("p",{className:"font-semibold",children:s._json.name}),(0,e.jsx)("p",{className:"font-semibold",children:s._json.email})]},"profile"),(0,e.jsx)(h,{children:"Help & Feedback"},"help_and_feedback"),(0,e.jsx)(h,{color:"danger",children:(0,e.jsx)(r,{onClick:he,children:" Sign Out "})},"logout")]})]})})]}),(0,e.jsxs)("div",{className:"product_table",children:[(0,e.jsxs)("div",{className:"card_text",children:[(0,e.jsx)(I,{placement:"top-start",content:"Back",children:(0,e.jsx)(w,{to:"/products",children:(0,e.jsx)("img",{className:"back_icon",src:"/back.svg",alt:"back icon"})})},"top-start"),(0,e.jsx)("h1",{children:m})]}),(0,e.jsxs)("h2",{className:"total-reviews",children:["Total Reviews: ",g]}),g>0?(0,e.jsxs)("div",{className:"table-review",children:[(0,e.jsxs)("table",{children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:"Image"}),(0,e.jsx)("th",{children:"User Name"}),(0,e.jsx)("th",{children:"Country"}),(0,e.jsx)("th",{children:"Review Content"}),(0,e.jsx)("th",{children:"Rating"}),(0,e.jsx)("th",{}),(0,e.jsxs)("th",{children:[" ",(0,e.jsx)("div",{className:"filter_review",children:(0,e.jsxs)(U,{children:[(0,e.jsx)(_,{children:(0,e.jsx)(r,{variant:"bordered",children:(0,e.jsx)("img",{className:"edit_icon",src:"/filter.svg",alt:"filter"})})}),(0,e.jsxs)(S,{"aria-label":"Static Actions",children:[(0,e.jsx)(h,{children:(0,e.jsx)("div",{className:"btn_sort",children:(0,e.jsx)("button",{onClick:()=>handleSort("asc"),children:"Sort A-Z"})})},"new"),(0,e.jsx)(h,{children:(0,e.jsx)("div",{className:"btn_sort",children:(0,e.jsx)("button",{onClick:()=>handleSort("desc"),children:"Sort Z-A"})})},"copy")]})]})})]})]})}),(0,e.jsx)("tbody",{children:P.slice(M,V).map(t=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:(0,e.jsx)("img",{src:t.productImage,alt:""})}),(0,e.jsx)("td",{children:t.userName}),(0,e.jsx)("td",{children:t.userContry}),(0,e.jsx)("td",{children:t.reviewContent}),(0,e.jsx)("td",{children:(0,e.jsx)(Me,{rating:t.rating})}),(0,e.jsxs)("td",{children:[(0,e.jsx)(I,{content:"Edit review",children:(0,e.jsx)(r,{onClick:()=>pe(t),variant:"faded",size:"sm",children:(0,e.jsx)("img",{className:"edit_icon",src:"/edit.svg",alt:"edit icon"})})}),i&&(0,e.jsx)(F,{size:"4xl",isOpen:le,onOpenChange:b,scrollBehavior:de,children:(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(T,{children:[(0,e.jsx)(E,{className:"flex flex-col gap-1",children:(0,e.jsx)("h1",{children:"Edit review"})}),(0,e.jsxs)(O,{children:[(0,e.jsx)("label",{children:"Image URL:"}),(0,e.jsx)("div",{children:(0,e.jsx)(ee,{onUpload:Ne})}),j&&(0,e.jsx)("p",{style:{color:"red"},children:j}),(R||i.productImage)&&(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{children:"Image:"}),(0,e.jsx)("img",{src:R||i.productImage,alt:"Uploaded",height:"100px",width:"100px"})]}),(0,e.jsxs)(x,{method:"post",action:"/update_review",onSubmit:be,className:"edit_from",children:[(0,e.jsx)("input",{type:"hidden",name:"reviewId",value:i.id}),(0,e.jsxs)("label",{children:[(0,e.jsx)("input",{type:"hidden",name:"url",value:R})," "]}),(0,e.jsxs)("label",{children:["Name:",(0,e.jsx)("input",{type:"text",name:"name",defaultValue:i.userName,required:!0})]}),(0,e.jsxs)("label",{children:["Country:",(0,e.jsx)("input",{type:"text",name:"country",defaultValue:i.userContry,required:!0})]}),(0,e.jsxs)("label",{children:["Content:",(0,e.jsx)("textarea",{name:"content",id:"content",defaultValue:i.reviewContent,required:!0})]}),(0,e.jsxs)("label",{children:["Rating:",(0,e.jsx)("input",{type:"number",name:"rating",min:"1",max:"5",defaultValue:i.rating,onBlur:o=>{let p=parseInt(o.target.value,10);(isNaN(p)||p<1||p>5)&&(o.target.value=i.rating)}})]}),(0,e.jsxs)(L,{children:[(0,e.jsx)(r,{onClick:()=>b(!1),children:"Cancel"}),(0,e.jsx)(r,{type:"submit",disabled:N,children:N?"Updating...":"Update"})]})]})]})]})})})]}),(0,e.jsxs)("td",{children:[(0,e.jsx)(I,{content:"Delete review",children:(0,e.jsx)(r,{onPress:()=>ue(t.id),variant:"faded",size:"sm",type:"submit",children:(0,e.jsx)("img",{className:"delete_icon",src:"/trash.svg",alt:"delete icon"})})}),re===t.id&&(0,e.jsx)(F,{isOpen:ae,onOpenChange:C,isDismissable:!1,isKeyboardDismissDisabled:!0,children:(0,e.jsx)(T,{children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(E,{className:"flex flex-col gap-1",children:"Delete Review"}),(0,e.jsx)(O,{children:(0,e.jsx)("p",{children:"Are you sure you want to delete this review?"})}),(0,e.jsxs)(L,{children:[(0,e.jsx)(r,{color:"danger",variant:"light",onPress:H,children:"Cancel"}),(0,e.jsxs)(x,{method:"post",action:"/delete_review",onSubmit:me,children:[(0,e.jsx)("input",{type:"hidden",name:"reviewId",value:t.id}),(0,e.jsx)(r,{type:"submit",disabled:N,children:N?"Deleting...":"Delete"})]})]})]})})})]})]},t.id))})]}),(0,e.jsxs)("div",{className:"pagination",children:[(0,e.jsx)(r,{size:"sm",variant:"bordered",onClick:ve,disabled:a===1,children:"Previous"}),we().map((t,o)=>(0,e.jsx)("span",{children:t==="backward"?(0,e.jsx)(r,{size:"sm",variant:"bordered",onClick:()=>v(a-3),className:"ellipsis-button ellipsis-backward",children:"..."}):t==="forward"?(0,e.jsx)(r,{size:"sm",variant:"bordered",onClick:()=>v(a+3),className:"ellipsis-button ellipsis-forward",children:"..."}):(0,e.jsx)(r,{size:"sm",variant:a===t?"solid":"bordered",onClick:()=>v(t),children:t})},o)),(0,e.jsx)(r,{size:"sm",variant:"bordered",onClick:ge,disabled:a===l,children:"Next"})]})]}):(0,e.jsx)("p",{className:"no-reviews",children:"No reviews available."})]})]})}export{oe as default};
