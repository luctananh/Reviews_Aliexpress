import"/build/_shared/chunk-APGL74VL.js";import"/build/_shared/chunk-APGL74VL.js";import{a as O,b as T,c as E,d as F,e as z}from"/build/_shared/chunk-ROFSN5VO.js";import{a as P,b as te}from"/build/_shared/chunk-AYIHL7SN.js";import{a as J}from"/build/_shared/chunk-KHH5AA7I.js";import{b as Q,c as X,d as A,e as k}from"/build/_shared/chunk-BMZJEWOM.js";import{a as ee}from"/build/_shared/chunk-JFGTJ2G4.js";import{g as f,h as S,i as L,j as U,k as Ie,l as ke}from"/build/_shared/chunk-P7B4R23W.js";import"/build/_shared/chunk-JI256XCL.js";import"/build/_shared/chunk-P6ZGV53T.js";import{q as r}from"/build/_shared/chunk-5LJH62OD.js";import{a as g,b as Y}from"/build/_shared/chunk-VRBKQU2G.js";import"/build/_shared/chunk-SSRZKJVQ.js";import"/build/_shared/chunk-UIOUHADL.js";import{d as v,f as Ce,g as I,h as M,m as q,o as K}from"/build/_shared/chunk-3D2VXHQT.js";import{a as Z,b as G}from"/build/_shared/chunk-F33EF4G7.js";import{d as m}from"/build/_shared/chunk-2QEWK57A.js";var ae=m(Z(),1);var De=m(Ie(),1),Re=m(ke(),1);var _e=m(ee(),1);var Be=m(ee(),1);Ce();var s=m(Z(),1);var e=m(G(),1);var oe=h=>{let n=[];return h.forEach(u=>{let i=u.reviews.map(D=>({...D,productName:u.name,productId:u.id}));n=n.concat(i)}),n};console.log(oe.length);var xe=({rating:h})=>{let n=parseInt(h,10);if(isNaN(n))return(0,e.jsx)("div",{children:"Invalid rating"});let u=[];for(let i=1;i<=5;i++)u.push((0,e.jsx)("span",{className:i<=n?"star filled":"star",children:"\u2605"},i));return(0,e.jsx)("div",{className:"star-rating",children:u})};function re(){let{products:h,user:n}=q(),[u,i]=(0,s.useState)(!1),[D,R]=(0,s.useState)(null),[l,se]=(0,s.useState)(null),[Me,ne]=(0,s.useState)(""),[Pe,ie]=(0,s.useState)(!1),[le,b]=(0,s.useState)(!1),[_,j]=(0,s.useState)(""),[$,H]=(0,s.useState)(""),[de,Se]=ae.default.useState("inside"),ce=K(),ue=t=>{R(t),i(!0)},Le=t=>{R(t),ie(!0)},me=t=>{se(t),ne(t.reviewContent),b(!0)},[N,y]=(0,s.useState)(!1),pe=async t=>{t.preventDefault(),y(!0);let a=new FormData(t.target),p=a.get("reviewId");try{let c=await fetch("/delete_review",{method:"POST",body:a});console.log(c.status),c.ok?g.success("Deleted successful."):g.error(`Failed to delete. Status code: ${c.status}`)}catch(c){console.error("Error deleting review:",c),g.error("An error occurred while deleting the review.")}finally{y(!1),setTimeout(()=>{window.location.reload()},500),V()}},V=()=>{i(!1),R(null)},ve=()=>{ce.submit(null,{method:"post",action:"/auth/logout"})},[o,w]=(0,s.useState)(()=>{if(typeof window<"u"){let t=new URLSearchParams(window.location.search),a=parseInt(t.get("currentPage"),10);return a&&!isNaN(a)?a:1}return 1}),B=10;(0,s.useEffect)(()=>{if(typeof window<"u"){let t=new URLSearchParams(window.location.search);t.set("currentPage",o),window.history.replaceState({},"",`${window.location.pathname}?${t}`)}},[o]);let C=oe(h),fe=C.length,d=Math.ceil(fe/B),x=(o-1)*B,W=x+B,Ue=C.slice(x,W),ge=()=>{w(t=>Math.min(t+1,d))},he=()=>{w(t=>Math.max(t-1,1))},we=()=>{let t=[];if(t.push(1),d>5)if(o<=4){for(let a=2;a<=5;a++)t.push(a);t.push("forward"),t.push(d)}else if(o>=5&&o<=d-4)t.push("backward"),t.push(o-1),t.push(o),t.push(o+1),t.push("forward"),t.push(d);else{t.push("backward");for(let a=d-4;a<=d;a++)t.push(a)}else for(let a=2;a<=d;a++)t.push(a);return t},be=async t=>{t.preventDefault(),y(!0);let a=new FormData(t.target);for(let[c,ye]of a.entries())console.log(`${c}: ${ye}`);let p=await fetch("/update_review",{method:"POST",body:a});if(p.ok)g.success("Review updated successfully",{autoClose:5e3}),b(!1);else{let c=await p.json();g.error(`Error: ${c.error}`)}setTimeout(()=>{window.location.reload()},500),y(!1)};function Ne(t,a){a?(H("Upload failed: "+a.message),j("")):(j(t),H(""))}return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Y,{position:"top-center",richColors:!0}),(0,e.jsxs)(Q,{className:"custom-navbar2",children:[(0,e.jsx)(X,{children:(0,e.jsx)("img",{src:"./logo.png",alt:"logo",height:"70px",width:"70px"})}),(0,e.jsxs)(A,{className:"hidden sm:flex gap-4",justify:"center",children:[(0,e.jsx)(k,{children:(0,e.jsx)(I,{color:"foreground",href:"#"})}),(0,e.jsx)(k,{children:(0,e.jsx)(I,{color:"foreground",href:"#","aria-current":"page"})}),(0,e.jsx)(k,{children:(0,e.jsx)(I,{color:"foreground",href:"#"})})]}),(0,e.jsx)(A,{as:"div",justify:"end",children:(0,e.jsxs)(U,{placement:"bottom-end",children:[(0,e.jsx)(L,{children:(0,e.jsx)(J,{isBordered:!0,as:"button",className:"transition-transform",color:"success",name:n._json.name,size:"sm",src:n._json.picture})}),(0,e.jsxs)(S,{"aria-label":"Profile Actions",variant:"flat",children:[(0,e.jsxs)(f,{className:"h-14 gap-2",children:[(0,e.jsx)("p",{className:"font-semibold",children:n._json.name}),(0,e.jsx)("p",{className:"font-semibold",children:n._json.email})]},"profile"),(0,e.jsx)(f,{children:"Help & Feedback"},"help_and_feedback"),(0,e.jsx)(f,{color:"danger",children:(0,e.jsx)(r,{onClick:ve,children:" Sign Out "})},"logout")]})]})})]}),(0,e.jsxs)("div",{className:"card_slide",children:[(0,e.jsx)("div",{className:"card_navar",children:(0,e.jsx)("nav",{className:"side-nav",children:(0,e.jsxs)("ul",{children:[(0,e.jsx)("li",{children:(0,e.jsx)(v,{to:"/products",exact:!0,activeClassName:"active",children:(0,e.jsxs)("div",{className:"nava_product",children:[(0,e.jsx)("img",{src:"/productst.svg",alt:"product-icon"}),(0,e.jsx)("p",{children:"Products"})]})})}),(0,e.jsx)("li",{children:(0,e.jsx)(v,{to:"/review_table",activeClassName:"active",children:(0,e.jsxs)("div",{className:"nava_product",children:[(0,e.jsx)("img",{src:"/review.svg",alt:"review-icon"}),(0,e.jsx)("p",{children:"Reviews"})]})})}),(0,e.jsx)("li",{children:(0,e.jsx)(v,{to:"/setting",activeClassName:"active",children:(0,e.jsxs)("div",{className:"nava_product",children:[(0,e.jsx)("img",{src:"/setting.svg",alt:"seting-icon"}),(0,e.jsx)("p",{children:"Setting"})]})})})]})})}),(0,e.jsxs)("div",{className:"product_table",children:[(0,e.jsx)("div",{className:"navbar-container",children:(0,e.jsx)("nav",{children:(0,e.jsxs)("ul",{children:[(0,e.jsx)("li",{children:(0,e.jsx)(v,{to:"/products",exact:!0,activeClassName:"active",children:"Products"})}),(0,e.jsx)("li",{children:(0,e.jsx)(v,{to:"/review_table",activeClassName:"active",children:"Reviews"})}),(0,e.jsx)("li",{children:(0,e.jsx)(v,{to:"/setting",activeClassName:"active",children:"Setting"})})]})})}),(0,e.jsx)("div",{className:"card_text",children:(0,e.jsx)("h1",{children:"Reviews"})}),(0,e.jsxs)("div",{className:"table-review",children:[(0,e.jsxs)("table",{children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:"Image"}),(0,e.jsx)("th",{children:"User Name"}),(0,e.jsx)("th",{children:"Country"}),(0,e.jsx)("th",{children:"Review Content"}),(0,e.jsx)("th",{children:"Rating"}),(0,e.jsx)("th",{}),(0,e.jsxs)("th",{children:[" ",(0,e.jsx)("div",{className:"filter_review",children:(0,e.jsxs)(U,{children:[(0,e.jsx)(L,{children:(0,e.jsx)(r,{variant:"bordered",children:(0,e.jsx)("img",{className:"filter_icon",src:"/filter.svg",alt:"filter"})})}),(0,e.jsxs)(S,{"aria-label":"Static Actions",children:[(0,e.jsx)(f,{children:(0,e.jsx)("div",{className:"btn_sort",children:(0,e.jsx)("a",{href:"?order=asc",children:"Sort A-Z"})})},"new"),(0,e.jsx)(f,{children:(0,e.jsx)("div",{className:"btn_sort",children:(0,e.jsx)("a",{href:"?order=desc",children:"Sort Z-A"})})},"copy")]})]})})]})]})}),(0,e.jsx)("tbody",{children:C.length>0?C.slice(x,W).map(t=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:(0,e.jsx)("img",{src:t.productImage,alt:""})}),(0,e.jsx)("td",{children:t.userName}),(0,e.jsx)("td",{children:t.userContry}),(0,e.jsx)("td",{children:t.reviewContent}),(0,e.jsx)("td",{children:(0,e.jsx)(xe,{rating:t.rating})}),(0,e.jsxs)("td",{children:[(0,e.jsx)(P,{content:"Edit review",children:(0,e.jsx)(r,{onClick:()=>me(t),variant:"faded",size:"sm",children:(0,e.jsx)("img",{className:"edit_icon",src:"./edit.svg",alt:"edit icon"})})}),l&&(0,e.jsx)(z,{size:"4xl",isOpen:le,onOpenChange:b,scrollBehavior:de,children:(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(T,{children:[(0,e.jsx)(F,{className:"flex flex-col gap-1",children:(0,e.jsx)("h1",{children:"Edit review"})}),(0,e.jsxs)(O,{children:[(0,e.jsx)("label",{children:"Image URL:"}),(0,e.jsx)("div",{children:(0,e.jsx)(te,{onUpload:Ne})}),$&&(0,e.jsx)("p",{style:{color:"red"},children:$}),(_||l.productImage)&&(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{children:"Image:"}),(0,e.jsx)("img",{src:_||l.productImage,alt:"Uploaded",height:"100px",width:"100px"})]}),(0,e.jsxs)(M,{method:"post",action:"/update_review",onSubmit:be,className:"edit_from",children:[(0,e.jsx)("input",{type:"hidden",name:"reviewId",value:l.id}),(0,e.jsx)("label",{children:(0,e.jsx)("input",{type:"hidden",name:"url",value:_})}),(0,e.jsxs)("label",{children:["Name:",(0,e.jsx)("input",{type:"text",name:"name",defaultValue:l.userName,required:!0})]}),(0,e.jsxs)("label",{children:["Country:",(0,e.jsx)("input",{type:"text",name:"country",defaultValue:l.userContry,required:!0})]}),(0,e.jsxs)("label",{children:["Content:",(0,e.jsx)("textarea",{name:"content",id:"content",defaultValue:l.reviewContent,required:!0})]}),(0,e.jsxs)("label",{children:["Rating:",(0,e.jsx)("input",{type:"number",name:"rating",min:"1",max:"5",defaultValue:l.rating,onBlur:a=>{let p=parseInt(a.target.value,10);(isNaN(p)||p<1||p>5)&&(a.target.value=l.rating)}})]}),(0,e.jsxs)(E,{children:[(0,e.jsx)(r,{onClick:()=>b(!1),children:"Cancel"}),(0,e.jsx)(r,{type:"submit",disabled:N,children:N?"Updating...":"Update"})]})]})]})]})})})]}),(0,e.jsxs)("td",{children:[(0,e.jsx)(P,{content:"Delete review",children:(0,e.jsx)(r,{onPress:()=>ue(t.id),variant:"faded",size:"sm",type:"submit",children:(0,e.jsx)("img",{className:"delete_icon",src:"./trash.svg",alt:"delete icon"})})}),D===t.id&&(0,e.jsx)(z,{isOpen:u,onOpenChange:i,isDismissable:!1,isKeyboardDismissDisabled:!0,children:(0,e.jsx)(T,{children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(F,{className:"flex flex-col gap-1",children:"Delete Review"}),(0,e.jsx)(O,{children:(0,e.jsx)("p",{children:"Are you sure you want to delete this review?"})}),(0,e.jsxs)(E,{children:[(0,e.jsx)(r,{color:"danger",variant:"light",onPress:V,children:"Cancel"}),(0,e.jsxs)(M,{method:"post",action:"/delete_review",onSubmit:pe,children:[(0,e.jsx)("input",{type:"hidden",name:"reviewId",value:t.id}),(0,e.jsx)(r,{type:"submit",disabled:N,children:N?"Deleting...":"Delete"})]})]})]})})})]})]},t.id)):(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:"6",className:"no-reviews",children:"No reviews available."})})})]}),(0,e.jsxs)("div",{className:"pagination",children:[(0,e.jsx)(r,{size:"sm",variant:"bordered",onClick:he,disabled:o===1,children:"Previous"}),we().map((t,a)=>(0,e.jsx)("span",{children:t==="backward"?(0,e.jsx)(r,{size:"sm",variant:"bordered",onClick:()=>w(o-3),className:"ellipsis-button ellipsis-backward",children:"..."}):t==="forward"?(0,e.jsx)(r,{size:"sm",variant:"bordered",onClick:()=>w(o+3),className:"ellipsis-button ellipsis-forward",children:"..."}):(0,e.jsx)(r,{size:"sm",variant:o===t?"solid":"bordered",onClick:()=>w(t),children:t})},a)),(0,e.jsx)(r,{size:"sm",variant:"bordered",onClick:ge,disabled:o===d,children:"Next"})]})]})]})]})]})}export{re as default};
